<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>レトロシューティングゲーム</title>
    <style>
        body {
            background-color: #000;
            color: #fff;
            font-family: 'Press Start 2P', cursive;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            position: relative;
        }
        h1 {
            font-size: 2rem;
            text-shadow: 2px 2px #f00;
        }
        canvas {
            border: 2px solid #fff;
            background-color: #111;
            box-shadow: 0 0 10px #fff;
        }
        #ui-container {
            position: absolute;
            top: 10px;
            left: 10px;
            width: calc(100% - 20px);
            z-index: 10;
        }
        #score, #ammo {
            font-size: 1.5rem;
        }
         #ammo {
            margin-top: 10px;
        }
        #boss-hp-container {
            display: none;
            margin-top: 10px;
        }
        #boss-hp-bar {
            width: 100%;
            height: 20px;
            background-color: #555;
            border: 2px solid #fff;
        }
        #boss-hp-fill {
            width: 100%;
            height: 100%;
            background-color: #ff0000;
        }
        .message-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
            color: red;
            text-shadow: 3px 3px #000;
            display: none;
            z-index: 20;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="ui-container">
        <div id="score">SCORE: 0</div>
        <div id="ammo">AMMO: 50</div>
        <div id="boss-hp-container">
            BOSS HP
            <div id="boss-hp-bar">
                <div id="boss-hp-fill"></div>
            </div>
        </div>
    </div>
    <div id="messageText" class="message-text"></div>
    <h1>ROPPONGI STRIKE</h1>
    <canvas id="gameCanvas"></canvas>

    <script>
        /**
         * jsfxr-e V1.0 - https://github.com/ttencate/jsfxr
         */
        


        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('score');
        const ammoEl = document.getElementById('ammo');
        const messageText = document.getElementById('messageText');
        const bossHpContainer = document.getElementById('boss-hp-container');
        const bossHpFill = document.getElementById('boss-hp-fill');

        canvas.width = 480;
        canvas.height = 640;

        const GAME_WIDTH = canvas.width;
        const GAME_HEIGHT = canvas.height;
        
        let gameState, gameFrame, backgroundY, score, bossFightActive;
        let player, bullets, enemies, items, boss, particles, keys, enemySpawnTimer, shootCooldown;
        const STARTING_AMMO = 50;

        function init() {
            gameState = 'startScreen';
            gameFrame = 0;
            backgroundY = 0;
            score = 0;
            bossFightActive = false;
            
            player = {
                x: GAME_WIDTH / 2 - 24, y: GAME_HEIGHT - 100, width: 48, height: 64, speed: 5, dx: 0, dy: 0, powerUpTimer: 0, ammo: STARTING_AMMO,
                draw() {
                    const mainColor = this.powerUpTimer > 0 ? '#ffff00' : '#fefefe';
                    ctx.fillStyle = mainColor; ctx.fillRect(this.x, this.y, this.width, this.height);
                    ctx.fillStyle = '#ff4141'; ctx.beginPath(); ctx.arc(this.x + this.width / 2, this.y + this.height / 2, this.width / 2.5, 0, Math.PI * 2); ctx.fill();
                    ctx.fillStyle = '#000'; ctx.fillRect(this.x, this.y + 8, this.width, 2); ctx.fillRect(this.x, this.y + this.height - 10, this.width, 2);
                },
                move() {
                    this.x += this.dx;
                    this.y += this.dy;
                    if (this.x < 0) this.x = 0; if (this.x + this.width > GAME_WIDTH) this.x = GAME_WIDTH - this.width;
                    if (this.y < GAME_HEIGHT - 200) this.y = GAME_HEIGHT - 200;
                    if (this.y + this.height > GAME_HEIGHT) this.y = GAME_HEIGHT - this.height;
                }
            };
            bullets = []; enemies = []; items = []; particles = []; keys = {};
            boss = { x: GAME_WIDTH / 2 - 50, y: 50, width: 100, height: 100, speed: 2, hp: 150, maxHp: 150 };
            boss.draw = function() {
                ctx.fillStyle = '#ffcc99'; ctx.fillRect(this.x + 25, this.y, 50, 50); ctx.fillStyle = '#663300'; ctx.fillRect(this.x + 25, this.y, 50, 10);
                ctx.fillRect(this.x + 20, this.y + 10, 60, 10); ctx.fillStyle = 'blue'; ctx.fillRect(this.x, this.y + 50, 100, 50);
                ctx.fillStyle = 'black'; ctx.fillRect(this.x + 35, this.y + 20, 10, 10); ctx.fillRect(this.x + 55, this.y + 20, 10, 10);
                ctx.strokeStyle = 'black'; ctx.lineWidth = 3; ctx.beginPath(); ctx.moveTo(this.x + 40, this.y + 40); ctx.lineTo(this.x + 60, this.y + 40); ctx.stroke();
            };
            boss.move = function() { this.x += this.speed; if (this.x < 0 || this.x + this.width > GAME_WIDTH) this.speed *= -1; };
            
            scoreEl.style.display = 'none'; ammoEl.style.display = 'none'; bossHpContainer.style.display = 'none'; messageText.style.display = 'none';
            ctx.imageSmoothingEnabled = false;
            
            gameLoop();
        }

        function drawBackground(scrollSpeed = 1) {
            ctx.fillStyle = '#1a1a2e'; ctx.fillRect(0, 0, GAME_WIDTH, GAME_HEIGHT);
            const roadY = GAME_HEIGHT -100; 
            ctx.fillStyle = '#333'; ctx.fillRect(0, roadY, GAME_WIDTH, 100);
            ctx.fillStyle = '#ffff00'; const lineHeight = 40; const lineGap = 25;
            for (let y = (backgroundY % (lineHeight + lineGap)) + roadY; y < GAME_HEIGHT; y += (lineHeight + lineGap)) {
                 ctx.fillRect(GAME_WIDTH / 2 - 2, y, 4, lineHeight);
            }
            const treeWidth = 80; const treeHeight = 160;
            for (let i = 0; i < 8; i++) {
                let treeY = (backgroundY * 0.5 + (i * 180)) % (GAME_HEIGHT + treeHeight) - treeHeight;
                ctx.fillStyle = '#228B22'; ctx.fillRect(-30, treeY, treeWidth, treeHeight);
                ctx.fillRect(GAME_WIDTH - treeWidth + 30, treeY, treeWidth, treeHeight);
            }
            backgroundY = (backgroundY + scrollSpeed);
        }

        function drawStartScreen() {
            drawBackground(0.2); ctx.fillStyle = 'rgba(0, 0, 0, 0.4)'; ctx.fillRect(0, 0, GAME_WIDTH, GAME_HEIGHT);
            ctx.textAlign = 'center'; ctx.fillStyle = 'white'; ctx.strokeStyle = 'red'; ctx.lineWidth = 5;
            ctx.font = '40px "Press Start 2P"'; ctx.strokeText('ROPPONGI STRIKE', GAME_WIDTH / 2, 180); ctx.fillText('ROPPONGI STRIKE', GAME_WIDTH / 2, 180);
            ctx.font = '20px "Press Start 2P"';
            if (Math.floor(gameFrame / 30) % 2 === 0) { ctx.fillText('PRESS ENTER TO START', GAME_WIDTH / 2, 400); }
            ctx.font = '14px "Press Start 2P"'; ctx.fillStyle = '#ccc';
            ctx.fillText('--- HOW TO PLAY ---', GAME_WIDTH / 2, 460);
            ctx.fillText('WASD: MOVE', GAME_WIDTH / 2, 490);
            ctx.fillText('SPACE: SHOOT', GAME_WIDTH / 2, 520);
        }

        function shoot() {
            if (shootCooldown > 0 || player.ammo <= 0) return;
            
            player.ammo--;
            bullets.push({ x: player.x + player.width / 2 - 2, y: player.y, width: 4, height: 20 });
            shootCooldown = player.powerUpTimer > 0 ? 7 : 15;
        }

        function updatePlayer() {
            if (shootCooldown > 0) shootCooldown--;
            if (player.powerUpTimer > 0) player.powerUpTimer--;
            player.dx = 0; player.dy = 0;
            if (keys['a']) player.dx = -player.speed;
            if (keys['d']) player.dx = player.speed;
            if (keys['w']) player.dy = -player.speed;
            if (keys['s']) player.dy = player.speed;
            if (keys[' ']) shoot();
            player.move();
        }

        function updateBullets() {
            for (let i = bullets.length - 1; i >= 0; i--) {
                const b = bullets[i]; b.y -= 7;
                ctx.fillStyle = '#fdaa79'; ctx.fillRect(b.x, b.y, b.width, 6);
                ctx.fillStyle = '#fefefe'; ctx.fillRect(b.x, b.y - b.height + 6, b.width, b.height - 6);
                if (b.y < 0) bullets.splice(i, 1);
            }
        }

        function spawnEnemies() {
            if (bossFightActive || enemySpawnTimer-- > 0) return;
            let level = 1; let spawnInterval = 100;
            if (score >= 1000) { level = 3; spawnInterval = 60; }
            else if (score >= 400) { level = 2; spawnInterval = 80; }
            enemySpawnTimer = spawnInterval;
            enemies.push({ x: Math.random() * (GAME_WIDTH - 32), y: -40, width: 32, height: 40, level: level, hp: level === 2 ? 2 : 1, baseX: Math.random() * (GAME_WIDTH - 32) });
        }

        function updateEnemies() {
            for (let i = enemies.length - 1; i >= 0; i--) {
                const e = enemies[i];
                let speed = 1.0;
                if (e.level === 2) speed = 1.5;
                if (e.level === 3) { speed = 1.2; e.x = e.baseX + Math.sin(gameFrame * 0.05 + e.y * 0.1) * 20; }
                e.y += speed;
                const bodyColor = e.level === 1 ? '#00aaff' : e.level === 2 ? '#ffaa00' : '#aa00ff';
                ctx.fillStyle = bodyColor; ctx.fillRect(e.x, e.y + 10, e.width, e.height - 10);
                ctx.fillStyle = '#ffcc99'; ctx.fillRect(e.x + e.width / 2 - 5, e.y, 10, 10);
                if (e.hp < 2 && e.level === 2) { ctx.fillStyle = 'rgba(0,0,0,0.4)'; ctx.fillRect(e.x, e.y, e.width, e.height); }
                if (e.y > GAME_HEIGHT) { enemies.splice(i, 1); if (!bossFightActive) { gameState = 'gameOver'; } }
            }
        }
        
        function spawnItem(x, y) {
            const itemType = Math.random() < 0.7 ? 'ammo' : 'powerup';
            items.push({ x, y, width: 20, height: 28, type: itemType });
        }
        
        function updateItems() {
             for (let i = items.length - 1; i >= 0; i--) {
                const item = items[i];
                item.y += 2;
                if (item.type === 'ammo') {
                    ctx.fillStyle = '#999';
                    ctx.fillRect(item.x, item.y, item.width, item.height);
                    ctx.fillStyle = '#ccc';
                    ctx.fillRect(item.x + 4, item.y, item.width - 8, 4);

                } else {
                    ctx.fillStyle = '#c0c0c0'; ctx.fillRect(item.x, item.y, item.width, item.height);
                    ctx.fillStyle = '#e0e0e0'; ctx.fillRect(item.x + 2, item.y + 2, item.width - 4, 4);
                    ctx.fillStyle = 'orange'; ctx.fillRect(item.x + item.width / 2 - 3, item.y - 8, 6, 10);
                    ctx.fillStyle = 'yellow'; ctx.fillRect(item.x + item.width / 2 - 1, item.y - 5, 2, 6);
                }
                if (item.y > GAME_HEIGHT) items.splice(i, 1);
            }
        }

        function updateBoss() { if (!bossFightActive) return; boss.move(); boss.draw(); }

        function updateParticles() {
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i]; p.x += p.dx; p.y += p.dy; p.life--; ctx.fillStyle = p.color; ctx.globalAlpha = p.life / 30;
                ctx.fillRect(p.x, p.y, p.size, p.size); if (p.life <= 0) particles.splice(i, 1);
            }
            ctx.globalAlpha = 1.0;
        }
        
        function checkCollisions() {
            for (let i = enemies.length - 1; i >= 0; i--) {
                for (let j = bullets.length - 1; j >= 0; j--) {
                    const e = enemies[i], b = bullets[j]; if (!e || !b) continue;
                    if (b.x < e.x + e.width && b.x + b.width > e.x && b.y < e.y + e.height && b.y + b.height > e.y) {
                        bullets.splice(j, 1); e.hp--;
                        if (e.hp <= 0) {
                            if(Math.random() < 0.2) spawnItem(e.x, e.y);
                            enemies.splice(i, 1); score += 10 * e.level; scoreEl.innerText = `SCORE: ${score}`;
                        }
                        break;
                    }
                }
            }
            for (let i = items.length - 1; i >= 0; i--) {
                const item = items[i];
                if (player.x < item.x + item.width && player.x + player.width > item.x && player.y < item.y + item.height && player.y + player.height > item.y) {
                    if (item.type === 'ammo') {
                        player.ammo += 25;
                    } else {
                        player.powerUpTimer = 600;
                    }
                    
                    items.splice(i, 1); 
                }
            }
            if (bossFightActive) {
                for (let i = bullets.length - 1; i >= 0; i--) {
                    const b = bullets[i];
                    if (b.x < boss.x + boss.width && b.x + b.width > boss.x && b.y < boss.y + boss.height && b.y + b.height > boss.y) {
                        bullets.splice(i, 1); boss.hp -= (player.powerUpTimer > 0 ? 3: 2);
                        bossHpFill.style.width = `${Math.max(0, boss.hp / boss.maxHp) * 100}%`;
                        if (boss.hp <= 0) { gameState = 'gameClear'; }
                    }
                }
            }
        }

        function checkBossTrigger() {
            if (!bossFightActive && score >= 1500) {
                bossFightActive = true; enemies.length = 0; items.length = 0; bossHpContainer.style.display = 'block';
            }
        }

        function gameLoop() {
            gameFrame++;
            ctx.clearRect(0, 0, GAME_WIDTH, GAME_HEIGHT);
            
            switch (gameState) {
                case 'startScreen':
                    drawStartScreen();
                    break;
                case 'playing':
                    drawBackground();
                    updatePlayer();
                    player.draw();
                    updateBullets();
                    spawnEnemies();
                    updateEnemies();
                    updateItems();
                    updateBoss();
                    updateParticles();
                    checkCollisions();
                    checkBossTrigger();
                    ammoEl.innerText = `AMMO: ${player.ammo}`;
                    scoreEl.innerText = `SCORE: ${score}`;
                    break;
                case 'gameOver':
                    drawBackground(0.5); updateParticles();
                    messageText.innerText = 'GAME OVER'; messageText.style.display = 'block';
                    break;
                case 'gameClear':
                    drawBackground(0.5); updateParticles();
                    messageText.innerText = 'YOU WIN!'; messageText.style.color = 'yellow'; messageText.style.display = 'block';
                    break;
            }
            requestAnimationFrame(gameLoop);
        }

        document.addEventListener('keydown', (e) => {
            const key = e.key.toLowerCase();
            keys[key] = true;
            if (gameState === 'startScreen' && key === 'enter') {
                gameState = 'playing';
                score = 0;
                player.ammo = STARTING_AMMO;
                scoreEl.innerText = `SCORE: 0`;
                scoreEl.style.display = 'block';
                ammoEl.style.display = 'block';
                
            } else if ((gameState === 'gameOver' || gameState === 'gameClear') && key === 'enter') {
                init();
            }
        });
        document.addEventListener('keyup', (e) => { keys[e.key.toLowerCase()] = false; });
        
        init();
    </script>
</body>
</html>